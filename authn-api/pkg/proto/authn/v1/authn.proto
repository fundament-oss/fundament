syntax = "proto3";

package authn.v1;

option go_package = "github.com/fundament-oss/fundament/authn-api/pkg/proto/gen/authn/v1;authnv1";

service AuthnService {
  // GetUserInfo returns the current user's information
  // Validates the JWT from Authorization header or cookie
  rpc GetUserInfo(GetUserInfoRequest) returns (GetUserInfoResponse);
}

// TokenService handles API token operations
service TokenService {
  // ExchangeToken exchanges an API key for a short-lived JWT
  // The API key should be provided in the Authorization header as Bearer token
  rpc ExchangeToken(ExchangeTokenRequest) returns (ExchangeTokenResponse);
}

message GetUserInfoRequest {}

message GetUserInfoResponse {
  // User information
  User user = 10;
}

message User {
  // User ID
  string id = 10;
  // Organization IDs
  repeated string organization_ids = 20;
  // User name
  string name = 30;
  // External ID from OIDC provider
  string external_ref = 40;
  // Groups the user belongs to
  repeated string groups = 50;
}

// ExchangeToken request - empty, API key is in Authorization header
message ExchangeTokenRequest {}

// ExchangeToken response
message ExchangeTokenResponse {
  // JWT access token for API calls
  string access_token = 10;
  // Token type (always "Bearer")
  string token_type = 20;
  // Seconds until token expires
  int64 expires_in = 30;
}
