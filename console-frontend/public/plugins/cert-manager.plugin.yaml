apiVersion: fundament.io/v1
kind: PluginDefinition

metadata:
  name: cert-manager
  displayName: Cert Manager
  version: v1.19.3
  description: Automatic TLS certificate management using cert-manager. Supports ACME, CA, and self-signed issuers.
  icon: tablerShieldCheck
  author: Jetstack / CNCF
  tags:
    - security
    - tls
    - certificates

menu:
  organization:
    - crd: ClusterIssuer
      list: true
      detail: true
      create: true
  project:
    - crd: Certificate
      list: true
      detail: true
      create: true
    - crd: Issuer
      list: true
      detail: true
      create: true

uiHints:
  Certificate:
    formGroups:
      - name: Basic information
        fields: [secretName, commonName]
      - name: Issuer
        fields: [issuerRef]
      - name: Subject alternative names
        fields: [dnsNames, ipAddresses, uris, emailAddresses]
      - name: Duration & renewal
        fields: [duration, renewBefore]
      - name: Private key
        fields: [privateKey]
    hiddenFields:
      - additionalOutputFormats
      - keystores
      - nameConstraints
      - literalSubject
      - subject
      - encodeUsagesInRequest
      - otherNames
      - signatureAlgorithm
      - revisionHistoryLimit
      - secretTemplate
      - renewBeforePercentage
      - usages
      - isCA
    statusMapping:
      jsonPath: .status.conditions[?(@.type == "Ready")].status
      values:
        'True':
          badge: badge badge-sm badge-emerald
          label: Ready
        'False':
          badge: badge badge-sm badge-yellow
          label: Not ready
        'Unknown':
          badge: badge badge-sm badge-gray
          label: Unknown
  Issuer:
    formGroups:
      - name: CA configuration
        fields: [ca]
      - name: ACME configuration
        fields: [acme]
      - name: Self-signed
        fields: [selfSigned]
    hiddenFields:
      - vault
      - venafi
    statusMapping:
      jsonPath: .status.conditions[?(@.type == "Ready")].status
      values:
        'True':
          badge: badge badge-sm badge-emerald
          label: Ready
        'False':
          badge: badge badge-sm badge-yellow
          label: Not ready
  ClusterIssuer:
    formGroups:
      - name: CA configuration
        fields: [ca]
      - name: ACME configuration
        fields: [acme]
      - name: Self-signed
        fields: [selfSigned]
    hiddenFields:
      - vault
      - venafi
    statusMapping:
      jsonPath: .status.conditions[?(@.type == "Ready")].status
      values:
        'True':
          badge: badge badge-sm badge-emerald
          label: Ready
        'False':
          badge: badge badge-sm badge-yellow
          label: Not ready

crds:
  - |
    apiVersion: apiextensions.k8s.io/v1
    kind: CustomResourceDefinition
    metadata:
      name: certificates.cert-manager.io
    spec:
      group: cert-manager.io
      names:
        kind: Certificate
        plural: certificates
        singular: certificate
        shortNames:
          - cert
          - certs
      scope: Namespaced
      versions:
        - name: v1
          served: true
          storage: true
          additionalPrinterColumns:
            - jsonPath: .status.conditions[?(@.type == "Ready")].status
              name: Ready
              type: string
            - jsonPath: .spec.secretName
              name: Secret
              type: string
            - jsonPath: .spec.issuerRef.name
              name: Issuer
              priority: 1
              type: string
            - jsonPath: .status.conditions[?(@.type == "Ready")].message
              name: Status
              priority: 1
              type: string
            - jsonPath: .metadata.creationTimestamp
              name: Age
              type: date
          schema:
            openAPIV3Schema:
              description: A Certificate resource ensures an up to date signed X.509 certificate is stored in a Kubernetes Secret.
              type: object
              properties:
                apiVersion:
                  type: string
                kind:
                  type: string
                metadata:
                  type: object
                spec:
                  type: object
                  required:
                    - issuerRef
                    - secretName
                  properties:
                    secretName:
                      description: Name of the Secret resource that will be created and managed by this Certificate.
                      type: string
                    commonName:
                      description: Requested common name X509 certificate subject attribute.
                      type: string
                    dnsNames:
                      description: Requested DNS subject alternative names.
                      type: array
                      items:
                        type: string
                    ipAddresses:
                      description: Requested IP address subject alternative names.
                      type: array
                      items:
                        type: string
                    uris:
                      description: Requested URI subject alternative names.
                      type: array
                      items:
                        type: string
                    emailAddresses:
                      description: Requested email subject alternative names.
                      type: array
                      items:
                        type: string
                    issuerRef:
                      description: Reference to the issuer responsible for issuing the certificate.
                      type: object
                      required:
                        - name
                      properties:
                        name:
                          description: Name of the issuer.
                          type: string
                        kind:
                          description: "Kind of the issuer. Defaults to 'Issuer'."
                          type: string
                        group:
                          description: "Group of the issuer. Defaults to 'cert-manager.io'."
                          type: string
                    duration:
                      description: "Requested lifetime of the Certificate. Defaults to 90 days. Value must be in units accepted by Go time.ParseDuration."
                      type: string
                    renewBefore:
                      description: "How long before expiry cert-manager should renew the certificate. Defaults to 1/3 of the issued certificate's lifetime."
                      type: string
                    privateKey:
                      description: Private key options including algorithm, size, encoding, and rotation policy.
                      type: object
                      properties:
                        algorithm:
                          description: "Private key algorithm. Allowed values: RSA, ECDSA, Ed25519."
                          type: string
                          enum:
                            - RSA
                            - ECDSA
                            - Ed25519
                        size:
                          description: Key bit size of the private key.
                          type: integer
                        encoding:
                          description: "Private key encoding. Allowed values: PKCS1, PKCS8."
                          type: string
                          enum:
                            - PKCS1
                            - PKCS8
                        rotationPolicy:
                          description: "Controls how private keys should be regenerated during re-issuance."
                          type: string
                          enum:
                            - Never
                            - Always
                    isCA:
                      description: Whether this certificate is a CA certificate.
                      type: boolean
                    usages:
                      description: Requested key usages and extended key usages.
                      type: array
                      items:
                        type: string
                        enum:
                          - signing
                          - digital signature
                          - content commitment
                          - key encipherment
                          - key agreement
                          - data encipherment
                          - cert sign
                          - crl sign
                          - encipher only
                          - decipher only
                          - any
                          - server auth
                          - client auth
                          - code signing
                          - email protection
                          - s/mime
                          - ipsec end system
                          - ipsec tunnel
                          - ipsec user
                          - timestamping
                          - ocsp signing
                          - microsoft sgc
                          - netscape sgc
                status:
                  type: object
                  properties:
                    conditions:
                      type: array
                      items:
                        type: object
                        properties:
                          type:
                            type: string
                          status:
                            type: string
                            enum:
                              - "True"
                              - "False"
                              - Unknown
                          lastTransitionTime:
                            type: string
                            format: date-time
                          message:
                            type: string
                          reason:
                            type: string
                    notAfter:
                      type: string
                      format: date-time
                    notBefore:
                      type: string
                      format: date-time
                    renewalTime:
                      type: string
                      format: date-time
                    revision:
                      type: integer
  - |
    apiVersion: apiextensions.k8s.io/v1
    kind: CustomResourceDefinition
    metadata:
      name: issuers.cert-manager.io
    spec:
      group: cert-manager.io
      names:
        kind: Issuer
        plural: issuers
        singular: issuer
      scope: Namespaced
      versions:
        - name: v1
          served: true
          storage: true
          additionalPrinterColumns:
            - jsonPath: .status.conditions[?(@.type == "Ready")].status
              name: Ready
              type: string
            - jsonPath: .status.conditions[?(@.type == "Ready")].message
              name: Status
              priority: 1
              type: string
            - jsonPath: .metadata.creationTimestamp
              name: Age
              type: date
          schema:
            openAPIV3Schema:
              description: An Issuer represents a certificate issuing authority.
              type: object
              properties:
                apiVersion:
                  type: string
                kind:
                  type: string
                metadata:
                  type: object
                spec:
                  type: object
                  properties:
                    acme:
                      description: ACME configures this issuer to communicate with an ACME server.
                      type: object
                      properties:
                        server:
                          description: URL of the ACME server directory endpoint.
                          type: string
                        email:
                          description: Email address for the ACME account.
                          type: string
                        privateKeySecretRef:
                          description: Reference to a Secret containing the ACME account private key.
                          type: object
                          required:
                            - name
                          properties:
                            name:
                              description: Name of the Secret.
                              type: string
                    ca:
                      description: CA configures this issuer to sign certificates using a signing CA keypair.
                      type: object
                      properties:
                        secretName:
                          description: Name of the Secret containing the CA signing keypair.
                          type: string
                    selfSigned:
                      description: SelfSigned configures this issuer to self-sign certificates.
                      type: object
                      properties: {}
                status:
                  type: object
                  properties:
                    conditions:
                      type: array
                      items:
                        type: object
                        properties:
                          type:
                            type: string
                          status:
                            type: string
                          lastTransitionTime:
                            type: string
                            format: date-time
                          message:
                            type: string
  - |
    apiVersion: apiextensions.k8s.io/v1
    kind: CustomResourceDefinition
    metadata:
      name: clusterissuers.cert-manager.io
    spec:
      group: cert-manager.io
      names:
        kind: ClusterIssuer
        plural: clusterissuers
        singular: clusterissuer
      scope: Cluster
      versions:
        - name: v1
          served: true
          storage: true
          additionalPrinterColumns:
            - jsonPath: .status.conditions[?(@.type == "Ready")].status
              name: Ready
              type: string
            - jsonPath: .status.conditions[?(@.type == "Ready")].message
              name: Status
              priority: 1
              type: string
            - jsonPath: .metadata.creationTimestamp
              name: Age
              type: date
          schema:
            openAPIV3Schema:
              description: A ClusterIssuer represents a cluster-wide certificate issuing authority.
              type: object
              properties:
                apiVersion:
                  type: string
                kind:
                  type: string
                metadata:
                  type: object
                spec:
                  type: object
                  properties:
                    acme:
                      description: ACME configures this issuer to communicate with an ACME server.
                      type: object
                      properties:
                        server:
                          description: URL of the ACME server directory endpoint.
                          type: string
                        email:
                          description: Email address for the ACME account.
                          type: string
                        privateKeySecretRef:
                          description: Reference to a Secret containing the ACME account private key.
                          type: object
                          required:
                            - name
                          properties:
                            name:
                              description: Name of the Secret.
                              type: string
                    ca:
                      description: CA configures this issuer to sign certificates using a signing CA keypair.
                      type: object
                      properties:
                        secretName:
                          description: Name of the Secret containing the CA signing keypair.
                          type: string
                    selfSigned:
                      description: SelfSigned configures this issuer to self-sign certificates.
                      type: object
                      properties: {}
                status:
                  type: object
                  properties:
                    conditions:
                      type: array
                      items:
                        type: object
                        properties:
                          type:
                            type: string
                          status:
                            type: string
                          lastTransitionTime:
                            type: string
                            format: date-time
                          message:
                            type: string
