server {
    # Listen on both IPv4 and IPv6
    listen 80;
    listen [::]:80;

    server_name _;

    # Document root and default index
    root /usr/share/nginx/html;
    index index.html;

    # -------------------------------------------------------------------------
    # Security headers
    #
    # CSP notes:
    #   - script-src 'self'            AOT-compiled Angular needs no 'unsafe-eval'
    #   - style-src 'unsafe-inline'    Angular inlines component styles at runtime
    #   - connect-src                  TODO: extend with your API origins in production,
    #                                  e.g. https://api.example.com https://authn.example.com
    #   - frame-ancestors 'none'       equivalent to X-Frame-Options DENY (superset)
    # -------------------------------------------------------------------------
    add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self'; frame-ancestors 'none'; object-src 'none'; base-uri 'self';" always;

    # Prevent the page from being embedded in a frame on any origin
    add_header X-Frame-Options "DENY" always;

    # Prevent MIME-type sniffing
    add_header X-Content-Type-Options "nosniff" always;

    # Send only the origin as referrer for cross-origin requests
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    # Disable access to sensitive browser features not needed by the app
    add_header Permissions-Policy "camera=(), microphone=(), geolocation=(), payment=()" always;

    # SPA routing: serve index.html for all routes
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Cache static assets (commented out for development)
    # Uncomment in production to enable browser caching
    # TODO: make configurable via env var
    # location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
    #     expires 1y;
    #     add_header Cache-Control "public, immutable";
    # }
}
