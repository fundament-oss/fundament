@if (issuer(); as issuer) {
  <div class="card">
    <!-- Header -->
    <div class="card-header">
      <div class="grid items-center gap-3 lg:grid-cols-2">
        <div>
          <div class="mb-1">
            <a
              routerLink="/issuers"
              class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-500 dark:text-indigo-400 dark:hover:text-indigo-300"
            >
              <ng-icon name="tablerArrowLeft" class="mr-1" size="1rem" />
              Back to issuers
            </a>
          </div>
          <h1 class="text-2xl font-bold dark:text-white">{{ issuer.name }}</h1>
          <p class="mt-1 text-sm text-gray-600 dark:text-gray-300">
            {{ issuer.kind }} · {{ issuer.type }}
          </p>
        </div>
        <div class="flex gap-2 lg:justify-end">
          <button
            type="button"
            (click)="editIssuer()"
            class="btn-light inline-flex shrink-0 items-center"
          >
            <ng-icon name="tablerPencil" class="mr-1.5" /> Edit
          </button>
          <button
            type="button"
            (click)="showDeleteModal.set(true)"
            class="btn-remove inline-flex shrink-0 items-center"
          >
            <ng-icon name="tablerTrash" class="mr-1.5" /> Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="card-body-lg space-y-6">
      <!-- Basics -->
      <div class="card card-body">
        <h3 class="mb-4 text-lg font-medium dark:text-white">Basics</h3>
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Name</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ issuer.name }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Kind</dt>
            <dd class="mt-1">
              @if (issuer.kind === 'ClusterIssuer') {
                <span class="badge badge-purple">ClusterIssuer</span>
              } @else {
                <span class="badge badge-blue">Issuer</span>
              }
            </dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Type</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ issuer.type }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Status</dt>
            <dd class="mt-1">
              @if (issuer.status === 'Ready') {
                <span class="badge badge-emerald">Ready</span>
              } @else {
                <span class="badge badge-yellow">Not Ready</span>
              }
            </dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Namespace</dt>
            <dd class="mt-1 text-sm dark:text-white">
              @if (issuer.namespace) {
                <span class="font-mono">{{ issuer.namespace }}</span>
              } @else {
                <span class="italic text-gray-400">cluster-scoped</span>
              }
            </dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Created</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ formatDate(issuer.created) }}</dd>
          </dl>
        </div>
      </div>

      <!-- ACME Configuration (only for ACME issuers) -->
      @if (issuer.type === 'ACME' && issuer.acme) {
        <div class="card card-body">
          <h3 class="mb-4 text-lg font-medium dark:text-white">ACME Configuration</h3>
          <div class="space-y-4">
            <dl>
              <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Server</dt>
              <dd class="mt-1 font-mono text-sm break-all dark:text-white">
                {{ issuer.acme.server }}
              </dd>
            </dl>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <dl>
                <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Email</dt>
                <dd class="mt-1 text-sm dark:text-white">{{ issuer.acme.email }}</dd>
              </dl>
              <dl>
                <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                  Private Key Secret
                </dt>
                <dd class="mt-1 font-mono text-sm dark:text-white">
                  {{ issuer.acme.privateKeySecret }}
                </dd>
              </dl>
            </div>
          </div>
        </div>

        <!-- Solvers -->
        <div class="card card-body">
          <h3 class="mb-4 text-lg font-medium dark:text-white">Solvers</h3>
          @if (issuer.acme.solvers.length > 0) {
            <div class="space-y-3">
              @for (solver of issuer.acme.solvers; track $index) {
                <div class="card card-body-sm">
                  <div class="flex items-center gap-3">
                    <span class="badge badge-gray">#{{ $index + 1 }}</span>
                    <span class="text-sm font-medium dark:text-white">{{ solver.type }}</span>
                  </div>
                  <div class="mt-2 grid grid-cols-1 gap-2 text-sm sm:grid-cols-2">
                    @if (solver.ingressClass) {
                      <div>
                        <span class="text-gray-500 dark:text-gray-400">Ingress class:</span>
                        <span class="ml-1 font-mono dark:text-white">{{
                          solver.ingressClass
                        }}</span>
                      </div>
                    }
                    @if (solver.provider) {
                      <div>
                        <span class="text-gray-500 dark:text-gray-400">Provider:</span>
                        <span class="ml-1 dark:text-white">{{ solver.provider }}</span>
                      </div>
                    }
                    @if (solver.selector) {
                      <div>
                        <span class="text-gray-500 dark:text-gray-400">Selector:</span>
                        <span class="ml-1 font-mono dark:text-white">{{ solver.selector }}</span>
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          } @else {
            <p class="text-sm text-gray-500 dark:text-gray-400">No solvers configured</p>
          }
        </div>
      }

      <!-- CA Configuration (only for CA issuers) -->
      @if (issuer.type === 'CA' && issuer.ca) {
        <div class="card card-body">
          <h3 class="mb-4 text-lg font-medium dark:text-white">CA Configuration</h3>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">CA Secret Name</dt>
            <dd class="mt-1 font-mono text-sm dark:text-white">{{ issuer.ca.secretName }}</dd>
          </dl>
        </div>
      }

      <!-- SelfSigned info -->
      @if (issuer.type === 'SelfSigned') {
        <div class="card card-body">
          <h3 class="mb-4 text-lg font-medium dark:text-white">Self-Signed Configuration</h3>
          <p class="text-sm text-gray-500 dark:text-gray-400">
            This issuer generates self-signed certificates. No additional configuration is required.
          </p>
        </div>
      }

      <!-- Conditions -->
      <div class="card card-body">
        <h3 class="mb-4 text-lg font-medium dark:text-white">Conditions</h3>
        @if (issuer.conditions.length > 0) {
          <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
              <thead>
                <tr class="border-b border-gray-200 dark:border-gray-800">
                  <th class="px-3 py-2 text-left font-medium text-gray-500 dark:text-gray-400">
                    Type
                  </th>
                  <th class="px-3 py-2 text-left font-medium text-gray-500 dark:text-gray-400">
                    Status
                  </th>
                  <th class="px-3 py-2 text-left font-medium text-gray-500 dark:text-gray-400">
                    Last Transition
                  </th>
                  <th class="px-3 py-2 text-left font-medium text-gray-500 dark:text-gray-400">
                    Message
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-100 dark:divide-gray-800">
                @for (condition of issuer.conditions; track condition.type) {
                  <tr>
                    <td class="px-3 py-2 font-medium dark:text-white">{{ condition.type }}</td>
                    <td class="px-3 py-2">
                      @if (condition.status === 'True') {
                        <span class="badge-sm badge-emerald">True</span>
                      } @else if (condition.status === 'False') {
                        <span class="badge-sm badge-rose">False</span>
                      } @else {
                        <span class="badge-sm badge-gray">Unknown</span>
                      }
                    </td>
                    <td class="px-3 py-2 text-gray-600 dark:text-gray-400">
                      {{ formatDateTime(condition.lastTransitionTime) }}
                    </td>
                    <td class="px-3 py-2 text-gray-600 dark:text-gray-400">
                      {{ condition.message || '—' }}
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <p class="text-sm text-gray-500 dark:text-gray-400">No conditions reported</p>
        }
      </div>

      <!-- Related Certificates -->
      <div class="card card-body">
        <h3 class="mb-4 text-lg font-medium dark:text-white">Certificates using this issuer</h3>
        @if (relatedCertificates().length > 0) {
          <div class="space-y-3">
            @for (cert of relatedCertificates(); track cert.id) {
              <div class="card card-body-sm flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium dark:text-white">{{ cert.name }}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    Namespace: {{ cert.namespace }}
                  </p>
                </div>
                <div class="flex items-center gap-3">
                  @if (cert.status === 'Ready') {
                    <span class="badge-sm badge-emerald">Ready</span>
                  } @else if (cert.status === 'NotReady') {
                    <span class="badge-sm badge-yellow">Not Ready</span>
                  } @else {
                    <span class="badge-sm badge-rose">Expired</span>
                  }
                  <a
                    [routerLink]="['/certificates', cert.id]"
                    class="btn-light inline-flex shrink-0 items-center text-sm!"
                  >
                    <ng-icon name="tablerEye" class="mr-1" /> View
                  </a>
                </div>
              </div>
            }
          </div>
        } @else {
          <p class="text-sm text-gray-500 dark:text-gray-400">
            No certificates are using this issuer
          </p>
        }
      </div>
    </div>
  </div>
} @else {
  <div class="card card-body-lg text-center">
    <p class="text-gray-600 dark:text-gray-300">Issuer not found</p>
    <a
      routerLink="/issuers"
      class="mt-4 inline-flex items-center text-sm text-indigo-600 hover:text-indigo-500 dark:text-indigo-400"
    >
      <ng-icon name="tablerArrowLeft" class="mr-1" size="1rem" />
      Back to issuers
    </a>
  </div>
}

<!-- Delete Issuer Modal -->
<app-modal
  [show]="showDeleteModal()"
  title="Delete issuer"
  [maxWidth]="'max-w-lg'"
  (modalClose)="showDeleteModal.set(false)"
>
  <div class="sm:flex sm:items-start">
    <div
      class="mx-auto flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-rose-100 sm:mx-0 sm:h-10 sm:w-10 dark:bg-rose-900/20"
    >
      <ng-icon
        name="tablerAlertTriangle"
        size="1.5rem"
        class="text-rose-600! dark:text-rose-400!"
      />
    </div>
    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
      <div class="mt-2">
        <p class="text-sm text-gray-600 dark:text-gray-400">
          Are you sure you want to delete issuer
          <span class="font-semibold text-gray-800 dark:text-white">{{ issuer()?.name }}</span
          >? Certificates referencing this issuer will no longer be able to renew.
        </p>
      </div>
    </div>
  </div>

  <div modal-footer class="modal-footer">
    <button type="button" (click)="showDeleteModal.set(false)" class="btn-secondary">Cancel</button>
    <button
      type="button"
      (click)="confirmDelete()"
      class="cursor-pointer items-center rounded-md border border-rose-700 bg-rose-600 px-4 py-2 text-sm font-medium text-white shadow-sm ring-rose-500 hover:bg-rose-700 focus:ring-2 focus:ring-rose-500 focus:ring-offset-2 focus:outline-none dark:border-rose-800 dark:bg-rose-700 dark:ring-offset-gray-950 dark:hover:bg-rose-800"
    >
      Yes, delete this issuer
    </button>
  </div>
</app-modal>
