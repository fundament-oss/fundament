<div class="min-h-screen bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-white">
  <!-- Header -->
  <header class="border-b border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950">
    <div class="mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between py-4">
        <div class="flex items-center">
          @if (!isLoginPage()) {
            <button
              (click)="toggleSidebar()"
              type="button"
              aria-label="Toggle sidebar"
              class="mr-3 cursor-pointer rounded-md p-2 text-gray-600 ring-indigo-500 hover:bg-gray-100 focus:ring-2 focus:outline-none lg:hidden dark:text-gray-300 dark:ring-offset-gray-950 dark:hover:bg-gray-800"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24">
                <path
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 6h18M3 12h18M3 18h18"
                />
              </svg>
            </button>
          }
          <h1 class="text-2xl font-bold text-indigo-700 dark:text-indigo-300">
            <!-- <a class="flex items-center" routerLink="/"><svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 mr-2" viewBox="0 0 25 24"><path fill="currentColor" fill-rule="evenodd" d="M8.667 6.75a2.25 2.25 0 0 1 2.25-2.25h3.167a2.25 2.25 0 0 1 2.25 2.25V9h.833a2.25 2.25 0 0 1 2.25 2.25v2.25h.833a2.25 2.25 0 0 1 2.25 2.25v3a.75.75 0 0 1-.75.75H3.25a.75.75 0 0 1-.75-.75v-3a2.25 2.25 0 0 1 2.25-2.25h.834v-2.25A2.25 2.25 0 0 1 7.834 9h.833zm1.5 2.25h4.667V6.75a.75.75 0 0 0-.75-.75h-3.167a.75.75 0 0 0-.75.75zm-2.333 1.5a.75.75 0 0 0-.75.75v2.25h4.667v-3zm5.417 0v3h4.666v-2.25a.75.75 0 0 0-.75-.75zM4.75 15a.75.75 0 0 0-.75.75V18h4.667v-3zm5.417 0v3h4.667v-3zm6.167 0v3H21v-2.25a.75.75 0 0 0-.75-.75z" clip-rule="evenodd"/></svg>
            Fundament</a> -->
            <!-- <a class="flex items-center" routerLink="/"><svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mr-2.5 text-sky-600" viewBox="0 0 16 16"><path fill="currentColor" d="M0 .5A.5.5 0 0 1 .5 0h15a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H14v2h1.5a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H14v2h1.5a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H.5a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5H2v-2H.5a.5.5 0 0 1-.5-.5v-3A.5.5 0 0 1 .5 6H2V4H.5a.5.5 0 0 1-.5-.5zM3 4v2h4.5V4zm5.5 0v2H13V4zM3 10v2h4.5v-2zm5.5 0v2H13v-2zM1 1v2h3.5V1zm4.5 0v2h5V1zm6 0v2H15V1zM1 7v2h3.5V7zm4.5 0v2h5V7zm6 0v2H15V7zM1 13v2h3.5v-2zm4.5 0v2h5v-2zm6 0v2H15v-2z"/></svg>
            Fundament</a> -->
            <a class="flex items-center" routerLink="/"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                class="mr-1.5 h-8 w-8 text-sky-600 dark:text-sky-400"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M6 5h12a1 1 0 0 1 1 1a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1a1 1 0 0 1 1-1m15-3v2H3V2zm-6 6h2v14h-2zM7 8h2v14H7zm4 0h2v14h-2z"
                />
              </svg>
              Fundament</a
            >
          </h1>
        </div>

        <!-- Right side dropdowns -->
        <div class="-my-1 flex items-center space-x-3">
          <!-- Theme (dark/light mode) Switcher -->
          <button
            (click)="toggleTheme()"
            type="button"
            role="switch"
            aria-label="Toggle dark mode"
            [attr.aria-checked]="isDarkMode()"
            class="group h-[25px] w-[42px] cursor-pointer rounded-full border border-gray-300 bg-gray-200 text-indigo-600 ring-indigo-500 outline-none focus:ring-2 focus:ring-offset-2 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:ring-offset-gray-950"
          >
            <span
              class="flex h-[21px] w-[21px] translate-x-0.5 items-center justify-center rounded-full bg-white text-gray-600 shadow transition-transform group-aria-checked:translate-x-[19px] dark:bg-gray-950 dark:text-gray-300"
            >
              @if (isDarkMode()) {
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24">
                  <path
                    fill="none"
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"
                  />
                </svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24">
                  <path
                    fill="none"
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 12a4 4 0 1 0 8 0a4 4 0 1 0-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7l-.7.7m0 11.4l.7.7m-12.1-.7l-.7.7"
                  />
                </svg>
              }
            </span>
          </button>

          @if (!isLoginPage()) {
            <div class="project-dropdown relative">
              <button
                (click)="toggleProjectDropdown()"
                class="flex cursor-pointer items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 ring-indigo-500 hover:bg-gray-50 focus:ring-2 focus:ring-offset-2 focus:outline-none dark:border-gray-950 dark:bg-gray-950 dark:text-white dark:ring-offset-gray-950 dark:hover:bg-gray-900"
              >
                {{ selectedProject() }}
                <svg class="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  ></path>
                </svg>
              </button>

              @if (projectDropdownOpen()) {
                <div
                  class="ring-opacity-5 absolute right-0 z-10 mt-2 w-48 rounded-md bg-white shadow-lg ring-1 ring-gray-300 dark:bg-gray-950 dark:ring-gray-800"
                >
                  <div class="py-1">
                    <button
                      (click)="selectProject('Project 1')"
                      class="block w-full cursor-pointer px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-900 dark:[&.bg-gray-100]:bg-gray-700"
                      [class.bg-gray-100]="selectedProject() === 'Project 1'"
                    >
                      Project 1
                    </button>
                    <button
                      (click)="selectProject('Project 2')"
                      class="block w-full cursor-pointer px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-900 dark:[&.bg-gray-100]:bg-gray-700"
                      [class.bg-gray-100]="selectedProject() === 'Project 2'"
                    >
                      Project 2
                    </button>
                  </div>
                </div>
              }
            </div>

            <!-- User Dropdown -->
            <div class="user-dropdown relative">
              <button
                (click)="toggleUserDropdown()"
                class="flex cursor-pointer items-center rounded-full text-indigo-600 ring-indigo-500 focus:ring-2 focus:outline-none dark:text-indigo-400 dark:ring-offset-gray-950"
                aria-label="User menu"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24">
                  <g
                    fill="none"
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                  >
                    <path d="M3 12a9 9 0 1 0 18 0a9 9 0 1 0-18 0" />
                    <path
                      d="M9 10a3 3 0 1 0 6 0a3 3 0 1 0-6 0m-2.832 8.849A4 4 0 0 1 10 16h4a4 4 0 0 1 3.834 2.855"
                    />
                  </g>
                </svg>
              </button>

              @if (userDropdownOpen()) {
                <div
                  class="ring-opacity-5 absolute right-0 z-10 mt-2 w-48 rounded-md bg-white shadow-lg ring-1 ring-gray-300 dark:bg-gray-950 dark:ring-gray-800"
                >
                  <div class="py-1">
                    <div
                      class="border-b border-gray-100 px-4 py-2 text-sm text-gray-500 dark:border-gray-950 dark:text-gray-300"
                    >
                      Logged in as {{ currentUser()?.name || 'Unknown' }}
                    </div>
                    <a
                      routerLink="/profile"
                      (click)="userDropdownOpen.set(false)"
                      class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-900"
                    >
                      My profile
                    </a>
                    <button
                      (click)="handleLogout()"
                      class="block w-full cursor-pointer px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 dark:text-white dark:hover:bg-gray-900"
                    >
                      Log out
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>
  </header>

  <div class="flex">
    <!-- Sidebar -->
    @if (!isLoginPage()) {
      <!-- Overlay for mobile -->
      <div
        class="fixed inset-0 z-40 bg-gray-900/50 transition-opacity duration-300 lg:hidden"
        [class.opacity-0]="!sidebarOpen()"
        [class.opacity-100]="sidebarOpen()"
        [class.pointer-events-none]="!sidebarOpen()"
        (click)="closeSidebar()"
        (keydown.escape)="closeSidebar()"
        role="button"
        tabindex="0"
        aria-label="Close sidebar"
      ></div>

      <!-- Sidebar -->
      <aside
        class="fixed inset-y-0 left-0 z-50 w-64 transform border-r border-gray-200 bg-white transition-transform duration-300 ease-in-out lg:static lg:min-h-[calc(100vh-4rem-1px)] lg:translate-x-0 dark:border-gray-800 dark:bg-gray-950"
        [class.-translate-x-full]="!sidebarOpen()"
      >
        <!-- Close button for mobile -->
        <div class="flex justify-end px-4 pt-4 lg:hidden">
          <button
            (click)="closeSidebar()"
            type="button"
            aria-label="Close sidebar"
            class="cursor-pointer rounded-md p-2 text-gray-600 ring-indigo-500 hover:bg-gray-100 focus:ring-2 focus:outline-none dark:text-gray-300 dark:ring-offset-gray-950 dark:hover:bg-gray-800"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24">
              <path
                fill="none"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <nav class="h-full overflow-y-auto px-4 pt-1 pb-6 lg:pt-4">
          <ul class="space-y-2">
            <li>
              <a
                routerLink="/"
                routerLinkActive="bg-indigo-50 text-indigo-700 dark:bg-indigo-950 dark:text-indigo-300"
                [routerLinkActiveOptions]="{ exact: true }"
                class="flex items-center rounded-md px-3 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
                (click)="closeSidebar()"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="mr-3 h-5 w-5" viewBox="0 0 24 24">
                  <path
                    fill="none"
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 4h4a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1m0 12h4a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1m10-4h4a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1m0-8h4a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1"
                  />
                </svg>
                Dashboard
              </a>
            </li>
            <li>
              <a
                routerLink="/cluster-overview"
                routerLinkActive="bg-indigo-50 text-indigo-700 dark:bg-indigo-950 dark:text-indigo-300"
                class="flex items-center rounded-md px-3 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 lg:pointer-events-auto dark:text-gray-300 dark:hover:bg-gray-800"
                (click)="closeSidebar()"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="mr-3 h-5 w-5" viewBox="0 0 24 24">
                  <path
                    fill="currentColor"
                    d="M12.074 1.424a.638.638 0 0 0-.686.691v.173c.015.2.044.402.087.588c.058.358.085.73.07 1.102a.65.65 0 0 1-.201.33l-.014.258a7 7 0 0 0-1.117.17a7.9 7.9 0 0 0-4.012 2.292l-.213-.157a.56.56 0 0 1-.374-.042a6 6 0 0 1-.829-.747c-.129-.143-.26-.299-.403-.428l-.128-.1a.8.8 0 0 0-.431-.171c-.2 0-.372.07-.501.212c-.2.301-.127.675.16.904l.013.014c.03.029.087.072.115.1q.258.172.515.3c.33.186.631.403.918.647a.63.63 0 0 1 .114.358l.2.17a7.82 7.82 0 0 0-1.232 5.546l-.271.07a.84.84 0 0 1-.275.274c-.358.086-.73.17-1.102.17c-.186 0-.387 0-.588.057l-.156.03h-.014v.015c-.043 0-.086.014-.115.014a.62.62 0 0 0-.4.789a.625.625 0 0 0 .772.386a1 1 0 0 0 .188-.045c.186-.057.37-.127.528-.213a7.4 7.4 0 0 1 1.103-.316c.114 0 .244.057.33.129l.285-.042a8.04 8.04 0 0 0 3.54 4.426l-.1.258a.8.8 0 0 1 .044.358c-.143.344-.33.687-.56.987c-.114.172-.215.33-.344.501c0 .043.001.117-.056.16c-.014.043-.044.072-.059.114a.615.615 0 0 0 .372.787a.62.62 0 0 0 .79-.372c.028-.043.055-.143.083-.143c.072-.2.131-.387.174-.574a5.4 5.4 0 0 1 .473-1.102a.5.5 0 0 1 .271-.129l.143-.257c1.82.702 3.84.701 5.688.014l.115.23a.53.53 0 0 1 .3.198c.186.33.301.674.43 1.032c.043.187.102.373.174.588c.028 0 .055.086.084.129c.014.043.03.071.044.114a.61.61 0 0 0 .845.216a.614.614 0 0 0 .213-.845c-.014-.057-.056-.13-.056-.174c-.115-.157-.23-.329-.344-.486c-.215-.316-.371-.63-.543-.974a.48.48 0 0 1 .042-.372a1.2 1.2 0 0 1-.1-.244c1.661-1.002 2.951-2.577 3.539-4.454c.086.014.17.028.271.042c.086-.115.201-.115.33-.115c.387.057.73.16 1.103.302q.235.128.514.213c.058.014.116.03.202.03v.015c0 .014.058.013.1.028c.344.043.617-.202.689-.532a.617.617 0 0 0-.532-.7c-.057-.014-.127-.03-.17-.072h-.588a7 7 0 0 1-1.102-.202a.6.6 0 0 1-.274-.257l-.272-.07a7.8 7.8 0 0 0-1.262-5.531l.23-.2a.44.44 0 0 1 .114-.343c.273-.244.589-.46.918-.647a3.6 3.6 0 0 0 .5-.3a1 1 0 0 0 .13-.1c.043-.028.086-.058.086-.087c.258-.243.273-.63 0-.859c-.214-.257-.601-.257-.845 0c-.043 0-.1.059-.142.087a11 11 0 0 0-.403.428c-.244.272-.53.532-.831.747a.55.55 0 0 1-.372.042l-.23.171a7.98 7.98 0 0 0-5.098-2.462l-.014-.274a.5.5 0 0 1-.201-.314a5.6 5.6 0 0 1 .07-1.102a4 4 0 0 0 .087-.588v-.316a.62.62 0 0 0-.546-.548m-.842 4.773l-.174 3.223h-.014a.56.56 0 0 1-.114.302a.543.543 0 0 1-.745.13h-.014L7.536 7.973a6.23 6.23 0 0 1 3.035-1.662c.23-.043.446-.086.66-.115zm1.544 0a6.38 6.38 0 0 1 3.682 1.777L13.837 9.85h-.014a.66.66 0 0 1-.3.073a.535.535 0 0 1-.56-.518zm-6.2 2.938l2.406 2.19v.015c.086.071.157.16.157.274a.523.523 0 0 1-.372.657v.014l-3.095.89a6.4 6.4 0 0 1 .904-4.04m10.842.042c.73 1.189 1.032 2.595.932 3.984l-3.109-.89l-.014-.014a.5.5 0 0 1-.257-.17a.53.53 0 0 1 .056-.761l-.014-.042zm-5.915 2.322h.988l.615.758l-.215.96l-.887.431l-.887-.43l-.23-.96zm-2.308 2.65h.115c.243 0 .46.17.545.414c0 .1.001.23-.056.302v.042l-1.22 2.966a6.33 6.33 0 0 1-2.563-3.195zm5.274 0h.344l3.193.515a6.34 6.34 0 0 1-2.563 3.223l-1.234-3.022c-.115-.258.002-.558.26-.716m-2.521 1.298a.55.55 0 0 1 .529.277h.014l1.561 2.823a5 5 0 0 1-.615.171a6.4 6.4 0 0 1-3.481-.17l1.561-2.824h.014c.043-.1.115-.144.216-.215a.5.5 0 0 1 .201-.062"
                  />
                </svg>
                Clusters
              </a>
            </li>
            <li>
              <a
                routerLink="/projects"
                routerLinkActive="bg-indigo-50 text-indigo-700 dark:bg-indigo-950 dark:text-indigo-300"
                class="flex items-center rounded-md px-3 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 lg:pointer-events-auto dark:text-gray-300 dark:hover:bg-gray-800"
                (click)="closeSidebar()"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="mr-3 h-5 w-5" viewBox="0 0 24 24">
                  <g
                    fill="none"
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                  >
                    <path
                      d="M9 3h3l2 2h5a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2"
                    />
                    <path d="M17 16v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2" />
                  </g>
                </svg>
                Projects
              </a>
            </li>
            <li>
              <a
                routerLink="/plugins"
                routerLinkActive="bg-indigo-50 text-indigo-700 dark:bg-indigo-950 dark:text-indigo-300"
                class="flex items-center rounded-md px-3 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 lg:pointer-events-auto dark:text-gray-300 dark:hover:bg-gray-800"
                (click)="closeSidebar()"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="mr-3 h-5 w-5" viewBox="0 0 24 24">
                  <path
                    fill="none"
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 7h3a1 1 0 0 0 1-1V5a2 2 0 0 1 4 0v1a1 1 0 0 0 1 1h3a1 1 0 0 1 1 1v3a1 1 0 0 0 1 1h1a2 2 0 0 1 0 4h-1a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1v-1a2 2 0 0 0-4 0v1a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a2 2 0 0 0 0-4H4a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1"
                  />
                </svg>
                Plugins
              </a>
            </li>
            <li>
              <a
                routerLink="/project-members"
                routerLinkActive="bg-indigo-50 text-indigo-700 dark:bg-indigo-950 dark:text-indigo-300"
                class="flex items-center rounded-md px-3 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 lg:pointer-events-auto dark:text-gray-300 dark:hover:bg-gray-800"
                (click)="closeSidebar()"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="mr-3 h-5 w-5" viewBox="0 0 24 24">
                  <path
                    fill="none"
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 7a4 4 0 1 0 8 0a4 4 0 1 0-8 0M3 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2m1-17.87a4 4 0 0 1 0 7.75M21 21v-2a4 4 0 0 0-3-3.85"
                  />
                </svg>
                Members
              </a>
            </li>
            <li>
              <a
                routerLink="/usage"
                routerLinkActive="bg-indigo-50 text-indigo-700 dark:bg-indigo-950 dark:text-indigo-300"
                class="flex items-center rounded-md px-3 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-100 lg:pointer-events-auto dark:text-gray-300 dark:hover:bg-gray-800"
                (click)="closeSidebar()"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="mr-3 h-5 w-5" viewBox="0 0 24 24">
                  <path
                    fill="currentColor"
                    d="m16 11.78l4.24-7.33l1.73 1l-5.23 9.05l-6.51-3.75L5.46 19H22v2H2V3h2v14.54L9.5 8z"
                  />
                </svg>
                Usage
              </a>
            </li>
          </ul>
        </nav>
      </aside>
    }

    <!-- Main Content -->
    <main class="mx-auto max-w-7xl flex-1 px-4 py-6 sm:px-6">
      <router-outlet />
    </main>
  </div>
</div>
