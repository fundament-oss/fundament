@if (certificate(); as cert) {
  <div class="card">
    <!-- Header -->
    <div class="card-header">
      <div class="grid items-center gap-3 lg:grid-cols-2">
        <div>
          <div class="mb-1">
            <a
              routerLink="/certificates"
              class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-500 dark:text-indigo-400 dark:hover:text-indigo-300"
            >
              <ng-icon name="tablerArrowLeft" class="mr-1" size="1rem" />
              Back to certificates
            </a>
          </div>
          <h1 class="text-2xl font-bold dark:text-white">{{ cert.name }}</h1>
          <p class="mt-1 text-sm text-gray-600 dark:text-gray-300">
            Created {{ formatDate(cert.created) }}
          </p>
        </div>
        <div class="flex gap-2 lg:justify-end">
          <button
            type="button"
            (click)="editCertificate()"
            class="btn-light inline-flex shrink-0 items-center"
          >
            <ng-icon name="tablerPencil" class="mr-1.5" /> Edit
          </button>
          <button
            type="button"
            (click)="showDeleteModal.set(true)"
            class="btn-remove inline-flex shrink-0 items-center"
          >
            <ng-icon name="tablerTrash" class="mr-1.5" /> Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="card-body-lg space-y-6">
      <!-- Basics -->
      <div class="card card-body">
        <h3 class="mb-4 text-lg font-medium dark:text-white">Basics</h3>
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Certificate name</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ cert.name }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Namespace</dt>
            <dd class="mt-1 font-mono text-sm dark:text-white">{{ cert.namespace }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Secret name</dt>
            <dd class="mt-1 font-mono text-sm dark:text-white">{{ cert.secretName }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Status</dt>
            <dd class="mt-1">
              @switch (cert.status) {
                @case ('Ready') {
                  <span class="badge badge-emerald">Ready</span>
                }
                @case ('NotReady') {
                  <span class="badge badge-yellow">Not Ready</span>
                }
                @case ('Expired') {
                  <span class="badge badge-rose">Expired</span>
                }
              }
            </dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Issuer</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ cert.issuerName }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Issuer kind</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ cert.issuerKind }}</dd>
          </dl>
        </div>
      </div>

      <!-- Subject & SANs -->
      <div class="card card-body">
        <h3 class="mb-4 text-lg font-medium dark:text-white">Subject Alternative Names</h3>
        <div class="space-y-4">
          <div>
            <dt class="mb-2 text-sm font-medium text-gray-500 dark:text-gray-400">DNS Names</dt>
            <dd class="flex flex-wrap gap-1">
              @if (cert.dnsNames.length > 0) {
                @for (dns of cert.dnsNames; track dns) {
                  <span class="badge badge-blue">{{ dns }}</span>
                }
              } @else {
                <span class="text-sm text-gray-400">None</span>
              }
            </dd>
          </div>
          <div>
            <dt class="mb-2 text-sm font-medium text-gray-500 dark:text-gray-400">IP Addresses</dt>
            <dd class="flex flex-wrap gap-1">
              @if (cert.ipAddresses.length > 0) {
                @for (ip of cert.ipAddresses; track ip) {
                  <span class="badge badge-purple">{{ ip }}</span>
                }
              } @else {
                <span class="text-sm text-gray-400">None</span>
              }
            </dd>
          </div>
          <div>
            <dt class="mb-2 text-sm font-medium text-gray-500 dark:text-gray-400">URIs</dt>
            <dd class="flex flex-wrap gap-1">
              @if (cert.uris.length > 0) {
                @for (uri of cert.uris; track uri) {
                  <span class="badge badge-gray">{{ uri }}</span>
                }
              } @else {
                <span class="text-sm text-gray-400">None</span>
              }
            </dd>
          </div>
        </div>
      </div>

      <!-- Validity & Renewal -->
      <div class="card card-body">
        <h3 class="mb-4 text-lg font-medium dark:text-white">Validity & Renewal</h3>
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Not Before</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ formatDate(cert.notBefore) }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
              Not After (Expires)
            </dt>
            <dd class="mt-1 text-sm dark:text-white">
              <span [class.text-red-600]="cert.status === 'Expired'">
                {{ formatDate(cert.notAfter) }}
              </span>
            </dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Next Renewal</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ formatDate(cert.nextRenewal) }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Duration</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ cert.duration }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Renew Before</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ cert.renewBefore }}</dd>
          </dl>
        </div>
      </div>

      <!-- Private Key Settings -->
      <div class="card card-body">
        <h3 class="mb-4 text-lg font-medium dark:text-white">Private Key</h3>
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Algorithm</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ cert.privateKey.algorithm }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Size</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ cert.privateKey.size }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Encoding</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ cert.privateKey.encoding }}</dd>
          </dl>
          <dl>
            <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Rotation Policy</dt>
            <dd class="mt-1 text-sm dark:text-white">{{ cert.privateKey.rotationPolicy }}</dd>
          </dl>
        </div>
      </div>

      <!-- Conditions -->
      <div class="card card-body">
        <h3 class="mb-4 text-lg font-medium dark:text-white">Conditions</h3>
        @if (cert.conditions.length > 0) {
          <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
              <thead>
                <tr class="border-b border-gray-200 dark:border-gray-800">
                  <th class="px-3 py-2 text-left font-medium text-gray-500 dark:text-gray-400">
                    Type
                  </th>
                  <th class="px-3 py-2 text-left font-medium text-gray-500 dark:text-gray-400">
                    Status
                  </th>
                  <th class="px-3 py-2 text-left font-medium text-gray-500 dark:text-gray-400">
                    Last Transition
                  </th>
                  <th class="px-3 py-2 text-left font-medium text-gray-500 dark:text-gray-400">
                    Message
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-100 dark:divide-gray-800">
                @for (condition of cert.conditions; track condition.type) {
                  <tr>
                    <td class="px-3 py-2 font-medium dark:text-white">{{ condition.type }}</td>
                    <td class="px-3 py-2">
                      @if (condition.status === 'True') {
                        <span class="badge-sm badge-emerald">True</span>
                      } @else if (condition.status === 'False') {
                        <span class="badge-sm badge-rose">False</span>
                      } @else {
                        <span class="badge-sm badge-gray">Unknown</span>
                      }
                    </td>
                    <td class="px-3 py-2 text-gray-600 dark:text-gray-400">
                      {{ formatDateTime(condition.lastTransitionTime) }}
                    </td>
                    <td class="px-3 py-2 text-gray-600 dark:text-gray-400">
                      {{ condition.message || 'â€”' }}
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <p class="text-sm text-gray-500 dark:text-gray-400">No conditions reported</p>
        }
      </div>

      <!-- Events -->
      <div class="card card-body">
        <h3 class="mb-4 text-lg font-medium dark:text-white">Events</h3>
        @if (cert.events.length > 0) {
          <div class="space-y-3">
            @for (event of cert.events; track event.id) {
              <div
                class="relative flex items-start space-x-3 after:absolute after:top-6 after:bottom-0 after:left-1 after:w-px after:bg-gray-300 after:content-[''] last:after:hidden dark:after:bg-gray-600"
              >
                <div class="flex-0">
                  <div
                    class="mt-2 h-2.5 w-2.5 rounded-full"
                    [class]="getEventDotColor(event.type)"
                  ></div>
                </div>
                <div class="min-w-0 flex-1">
                  <p class="text-sm font-medium dark:text-white">{{ event.type }}</p>
                  <p class="text-sm text-gray-500 dark:text-gray-400">{{ event.message }}</p>
                  <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                    {{ formatDateTime(event.timestamp) }}
                  </p>
                </div>
              </div>
            }
          </div>
        } @else {
          <p class="text-sm text-gray-500 dark:text-gray-400">No events recorded</p>
        }
      </div>
    </div>
  </div>
} @else {
  <div class="card card-body-lg text-center">
    <p class="text-gray-600 dark:text-gray-300">Certificate not found</p>
    <a
      routerLink="/certificates"
      class="mt-4 inline-flex items-center text-sm text-indigo-600 hover:text-indigo-500 dark:text-indigo-400"
    >
      <ng-icon name="tablerArrowLeft" class="mr-1" size="1rem" />
      Back to certificates
    </a>
  </div>
}

<!-- Delete Certificate Modal -->
<app-modal
  [show]="showDeleteModal()"
  title="Delete certificate"
  [maxWidth]="'max-w-lg'"
  (modalClose)="showDeleteModal.set(false)"
>
  <div class="sm:flex sm:items-start">
    <div
      class="mx-auto flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-rose-100 sm:mx-0 sm:h-10 sm:w-10 dark:bg-rose-900/20"
    >
      <ng-icon
        name="tablerAlertTriangle"
        size="1.5rem"
        class="text-rose-600! dark:text-rose-400!"
      />
    </div>
    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
      <div class="mt-2">
        <p class="text-sm text-gray-600 dark:text-gray-400">
          Are you sure you want to delete certificate
          <span class="font-semibold text-gray-800 dark:text-white">{{ certificate()?.name }}</span
          >? The associated TLS secret will also be removed.
        </p>
      </div>
    </div>
  </div>

  <div modal-footer class="modal-footer">
    <button type="button" (click)="showDeleteModal.set(false)" class="btn-secondary">Cancel</button>
    <button
      type="button"
      (click)="confirmDelete()"
      class="cursor-pointer items-center rounded-md border border-rose-700 bg-rose-600 px-4 py-2 text-sm font-medium text-white shadow-sm ring-rose-500 hover:bg-rose-700 focus:ring-2 focus:ring-rose-500 focus:ring-offset-2 focus:outline-none dark:border-rose-800 dark:bg-rose-700 dark:ring-offset-gray-950 dark:hover:bg-rose-800"
    >
      Yes, delete this certificate
    </button>
  </div>
</app-modal>
