<form (ngSubmit)="onSubmit()" #clusterForm="ngForm" class="space-y-6">
  <!-- Loading/Error State -->
  @if (isLoading()) {
    <div class="text-center text-gray-600 dark:text-gray-300">Loading plugins and presets...</div>
  } @else if (errorMessage()) {
    <div class="rounded-md bg-red-50 p-4 text-red-800 dark:bg-red-900 dark:text-red-200">
      {{ errorMessage() }}
    </div>
  } @else {
    <!-- Plugin Preset Selection -->
    <div class="space-y-4">
      <h3 class="text-lg font-medium dark:text-white">Plugin preset</h3>
      <div class="grid gap-4 md:grid-cols-3">
        @for (preset of presets; track preset.id) {
          <label
            class="block cursor-pointer rounded-md border border-gray-200 px-3 py-2 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900"
          >
            <span class="mb-1 flex items-center font-medium text-gray-700 dark:text-white">
              <input
                name="preset"
                type="radio"
                [value]="preset.id"
                [(ngModel)]="selectedPreset"
                (change)="onPresetChange()"
              />
              {{ preset.name }}
            </span>
            <span class="ml-6 block text-sm text-gray-600 dark:text-gray-300">
              {{ preset.description }}
            </span>
          </label>
        }

        <label
          class="block cursor-pointer rounded-md border border-gray-200 px-3 py-2 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900"
        >
          <span class="mb-1 flex items-center font-medium text-gray-700 dark:text-white">
            <input
              name="preset"
              type="radio"
              value="custom"
              [(ngModel)]="selectedPreset"
              (change)="onPresetChange()"
            />
            Custom plugin selection
          </span>
          <span class="ml-6 block text-sm text-gray-600 dark:text-gray-300"
            >Cherry pick plugins you need.</span
          >
        </label>
      </div>
    </div>

    <!-- Plugin Selection -->
    <div class="space-y-4">
      <h3 class="text-lg font-medium dark:text-white">Plugins</h3>
      <div class="space-y-4">
        @if (plugins.length === 0) {
          <p class="text-sm text-gray-600 dark:text-gray-400">No plugins found</p>
        } @else {
          @for (plugin of plugins; track plugin.id) {
            <div>
              <label class="inline-flex cursor-pointer items-center">
                <input
                  [id]="plugin.id"
                  type="checkbox"
                  [(ngModel)]="plugin.selected"
                  [name]="plugin.id"
                  [disabled]="selectedPreset !== 'custom'"
                  class="peer sr-only"
                />
                <span
                  class="peer-checked:after:border-buffer relative h-5 w-9 rounded-full bg-gray-200 peer-checked:bg-indigo-500 peer-focus:ring-2 peer-focus:ring-indigo-200 peer-focus:outline-none peer-disabled:opacity-60 after:absolute after:start-0.5 after:top-0.5 after:h-4 after:w-4 after:rounded-full after:bg-white after:transition-all after:content-[''] peer-checked:after:translate-x-full focus:ring-offset-2 rtl:peer-checked:after:-translate-x-full dark:bg-gray-800 dark:ring-offset-gray-950 dark:peer-focus:ring-indigo-800 dark:after:bg-gray-950"
                ></span>
                <span class="mr-1.5 ml-3 font-medium">{{ plugin.name }}</span>
              </label>
              <p class="-mt-0.5 ml-12 text-gray-500 dark:text-gray-400">
                {{ plugin.descriptionShort }}
              </p>
            </div>
          }
        }
      </div>
    </div>

    <!-- Custom Plugin Upload Section -->
    <div class="space-y-4">
      <h3 class="text-lg font-medium dark:text-white">Custom plugins</h3>
      <p class="text-sm text-gray-600 dark:text-gray-300">
        Upload a custom plugin as a ZIP file. Custom plugins can extend the functionality of your
        cluster.
      </p>

      <div class="space-y-4">
        <!-- Warning checkbox -->
        <label class="inline-flex cursor-pointer items-center">
          <input
            id="customPluginUploadEnabled"
            type="checkbox"
            [(ngModel)]="customPluginUploadEnabled"
            name="customPluginUploadEnabled"
            class="peer sr-only"
          />
          <span
            class="peer-checked:after:border-buffer relative h-5 w-9 rounded-full bg-gray-200 peer-checked:bg-indigo-500 peer-focus:ring-2 peer-focus:ring-indigo-200 peer-focus:outline-none after:absolute after:start-0.5 after:top-0.5 after:h-4 after:w-4 after:rounded-full after:bg-white after:transition-all after:content-[''] peer-checked:after:translate-x-full focus:ring-offset-2 rtl:peer-checked:after:-translate-x-full dark:bg-gray-800 dark:ring-offset-gray-950 dark:peer-focus:ring-indigo-800 dark:after:bg-gray-950"
          ></span>
          <span class="mr-1.5 ml-3 font-medium">
            Enable uploading custom plugins
            <span class="text-orange-700 dark:text-orange-400">(warranty on cluster void)</span>
          </span>
        </label>

        <!-- File upload input -->
        <div>
          <label
            for="customPluginFile"
            class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"
          >
            Upload plugin ZIP file
          </label>
          <input
            id="customPluginFile"
            type="file"
            accept=".zip"
            [disabled]="!customPluginUploadEnabled"
            (change)="onCustomPluginFileChange($event)"
            class="block w-full cursor-pointer rounded-lg border border-gray-300 bg-gray-50 text-sm text-gray-900 ring-indigo-500 file:mr-4 file:rounded-l-lg file:border-0 file:bg-indigo-50 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-indigo-700 hover:file:bg-indigo-100 focus:ring-2 focus:ring-offset-2 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-offset-gray-950 dark:file:bg-gray-700 dark:file:text-gray-300 dark:hover:file:bg-gray-600"
          />
          <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Only ZIP files are accepted</p>
        </div>
      </div>
    </div>

    <!-- Form Actions slot -->
    <div class="border-t border-gray-200 pt-6 dark:border-gray-800">
      <ng-content></ng-content>
    </div>
  }
</form>
