edition = "2023";

package organization.v1;

import "buf/validate/validate.proto";
import "google/protobuf/go_features.proto";
import "google/protobuf/timestamp.proto";
import "v1/common.proto";

option features.(pb.go).api_level = API_OPAQUE;
option features.field_presence = IMPLICIT;
option go_package = "github.com/fundament-oss/fundament/organization-api/pkg/proto/gen/v1;organizationv1";

// ProjectService manages projects within an organization
service ProjectService {
  // List all projects for the current organization
  rpc ListProjects(ListProjectsRequest) returns (ListProjectsResponse);

  // Get detailed information about a specific project
  rpc GetProject(GetProjectRequest) returns (GetProjectResponse);

  // Get a project by name
  rpc GetProjectByName(GetProjectByNameRequest) returns (GetProjectResponse);

  // Create a new project
  rpc CreateProject(CreateProjectRequest) returns (CreateProjectResponse);

  // Update project configuration
  rpc UpdateProject(UpdateProjectRequest) returns (UpdateProjectResponse);

  // Delete a project
  rpc DeleteProject(DeleteProjectRequest) returns (DeleteProjectResponse);

  // List all members of a project
  rpc ListProjectMembers(ListProjectMembersRequest) returns (ListProjectMembersResponse);

  // Get a single project member by ID
  rpc GetProjectMember(GetProjectMemberRequest) returns (GetProjectMemberResponse);

  // Add a member to a project (requires admin role)
  rpc AddProjectMember(AddProjectMemberRequest) returns (AddProjectMemberResponse);

  // Update a member's role (requires admin role)
  rpc UpdateProjectMemberRole(UpdateProjectMemberRoleRequest) returns (UpdateProjectMemberRoleResponse);

  // Remove a member from a project (requires admin role)
  rpc RemoveProjectMember(RemoveProjectMemberRequest) returns (RemoveProjectMemberResponse);
}

// List projects request
message ListProjectsRequest {
  string cluster_id = 10 [(buf.validate.field).string = {uuid: true}];
}

// List projects response
message ListProjectsResponse {
  repeated Project projects = 10;
}

// Get project request
message GetProjectRequest {
  string project_id = 10 [(buf.validate.field).string = {uuid: true}];
}

// Get project by name request
message GetProjectByNameRequest {
  string name = 10 [(buf.validate.field).cel = {
    id: "dns1123label"
    message: "must be a valid DNS-1123 label"
    expression: "this.matches('^[a-z]([-a-z0-9]{0,61}[a-z0-9])?$')"
  }];
}

// Get project response
message GetProjectResponse {
  Project project = 10;
}

// Project information
message Project {
  string id = 10;
  string cluster_id = 15;
  string name = 20;
  google.protobuf.Timestamp created = 30;
}

// Create project request
message CreateProjectRequest {
  string cluster_id = 5 [(buf.validate.field).string = {uuid: true}];
  string name = 10 [(buf.validate.field).cel = {
    id: "dns1123label"
    message: "must be a valid DNS-1123 label"
    expression: "this.matches('^[a-z]([-a-z0-9]{0,61}[a-z0-9])?$')"
  }];
}

// Create project response
message CreateProjectResponse {
  string project_id = 10;
}

// Update project request
message UpdateProjectRequest {
  string project_id = 10 [(buf.validate.field).string = {uuid: true}];
  string name = 20 [
    features.field_presence = EXPLICIT,
    (buf.validate.field).string = {
      min_len: 1
      max_len: 255
    }
  ];
}

// Update project response
message UpdateProjectResponse {}

// Delete project request
message DeleteProjectRequest {
  string project_id = 10 [(buf.validate.field).string = {uuid: true}];
}

// Delete project response
message DeleteProjectResponse {}

// Project member role
enum ProjectMemberRole {
  PROJECT_MEMBER_ROLE_UNSPECIFIED = 0;
  PROJECT_MEMBER_ROLE_ADMIN = 1;
  PROJECT_MEMBER_ROLE_VIEWER = 2;
}

// Project member information
message ProjectMember {
  string id = 10;
  string project_id = 20;
  string user_id = 30;
  string user_name = 40;
  ProjectMemberRole role = 50;
  google.protobuf.Timestamp created = 60;
}

// List project members request
message ListProjectMembersRequest {
  string project_id = 10 [(buf.validate.field).string = {uuid: true}];
}

// List project members response
message ListProjectMembersResponse {
  repeated ProjectMember members = 10;
}

// Get project member request
message GetProjectMemberRequest {
  string member_id = 10 [(buf.validate.field).string = {uuid: true}];
}

// Get project member response
message GetProjectMemberResponse {
  ProjectMember member = 10;
}

// Add project member request
message AddProjectMemberRequest {
  string project_id = 10 [(buf.validate.field).string = {uuid: true}];
  string user_id = 20 [(buf.validate.field).string = {uuid: true}];
  ProjectMemberRole role = 30 [(buf.validate.field).enum = {
    not_in: [0]
  }];
}

// Add project member response
message AddProjectMemberResponse {
  string member_id = 10;
}

// Update project member role request
message UpdateProjectMemberRoleRequest {
  string member_id = 10 [(buf.validate.field).string = {uuid: true}];
  ProjectMemberRole role = 20 [(buf.validate.field).enum = {
    not_in: [0]
  }];
}

// Update project member role response
message UpdateProjectMemberRoleResponse {}

// Remove project member request
message RemoveProjectMemberRequest {
  string member_id = 10 [(buf.validate.field).string = {uuid: true}];
}

// Remove project member response
message RemoveProjectMemberResponse {}
